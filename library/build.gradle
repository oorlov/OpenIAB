apply plugin: 'android-library'

repositories {
    maven {
        url 'https://github.com/Goddchen/mvn-repo/raw/master/'
        mavenCentral()
    }
    maven { url 'http://repo1.maven.org/maven2' }
}

dependencies {
    compile fileTree('libs')
}

// looking for android-sdk path in env.ANDROID_HOME
android {
    compileSdkVersion 17
    buildToolsVersion "17.0.0"

    defaultConfig {
        minSdkVersion 8
        targetSdkVersion 17
    }

    sourceSets {
        main {
            manifest.srcFile 'AndroidManifest.xml'
            java.srcDirs = ['src']
            aidl.srcDirs = ['src']
        }
    }
}

def createOpenIabLibraryJar() {
    println "Creating OpenIAB jar..."
    exec {
        executable 'jar'
        workingDir "build/classes/release"
        args 'cf', '../../OpenIAB.jar', 'com', 'org'
    }
}

def copyBuildToRoot() {
    mkdir '../build'
    copy {
        from 'build/OpenIAB.jar'
        into '../build'
    }
}

clean << {
    ant.delete(dir: "../build")
}

build << {
    createOpenIabLibraryJar()
    copyBuildToRoot()
}

defaultTasks 'build'